import torch
from yolov5 import train

# Configuração Apple Silicon
device = 'mps' if torch.backends.mps.is_available() else 'cpu'

train_config = {
    'weights': 'yolov5s.pt',
    'data': 'weapons.yaml',
    'epochs': 100,
    'batch-size': 16,  # Aumente conforme a memória permitir
    'img-size': 640,
    'device': device,
    'workers': 8,  # Usa todos os núcleos de CPU
    'optimizer': 'AdamW',  # Melhor performance no M1
    'cache': 'ram'  # Usa memória unificada
}

if __name__ == '__main__':
    # Força o uso máximo de recursos
    torch.set_num_threads(torch.get_num_threads())
    train.run(**train_config)